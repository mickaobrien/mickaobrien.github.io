<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>Oh, you trawler men</title>
        <link rel="stylesheet" href="/theme/css/main.css" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">Oh, you trawler men </a></h1>
                <nav><ul>
                    <li><a href="/category/misc.html">misc</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="/top-trumps-tutorial.html">Building a superhero Top Trumps game using Python and Ractive.js</a></h1>
<footer class="post-info">
        <abbr class="published" title="2014-03-22T10:20:00">
                Sat 22 March 2014
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="/author/mick.html">Mick</a>
        </address>
<p>In <a href="/category/misc.html">misc</a>. </p>
<p>tags: <a href="/tag/pelican.html">pelican</a><a href="/tag/publishing.html">publishing</a></p>
</footer><!-- /.post-info --><p>I want to build a superhero <a href="http://en.wikipedia.org/wiki/Top_trumps">Top Trumps</a> game. 
The data is available over at the <a href="http://superherodb.com/">Superhero Database</a>. Partially inspired by Ractive tutorials..
Unforunately they don't have an API so we have to scrape the data.
We first build a scraper in Python and then build a simple Top Trumps game using <a href="http://www.ractivejs.org/">Ractive.js</a>.</p>
<h2>Scraping the data</h2>
<p>The approach I took to scraping the data here is heavily informed by <a href="http://brianabelson.com/open-news/2013/12/17/scrape-the-gibson.html">this post</a> from Brian Abelson.
It makes use of really useful library of caching functions I stole from that blog post. A <code>cache/</code> directory is created where a local copy of each html page is stored the first time you scrape it. This copy is used for any future requests to that url. This means that as you debug your code or decide you want more data from the page, you're not bombarding the websites servers with requests.</p>
<p>The data we're going to get is located in the Powergrid for each character. So, e.g., for <a href="http://www.superherodb.com/Aqualad/10-1395/">Aqualad</a> we want to get values for intelligence, strength, speed, durability, power and combat.</p>
<p>We have a <code>get_superhero_data</code> function which starts by creating an empty <code>superhero</code> dict which will store all our data.</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">get_superhero_data</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">superhero</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>


<p>We then parse the ID of the superhero from the url:</p>
<div class="highlight"><pre><span class="n">superhero_id</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)[</span><span class="mi">4</span><span class="p">][</span><span class="mi">3</span><span class="p">:]</span>
<span class="n">superhero</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">superhero_id</span><span class="p">)</span>
</pre></div>


<p>it's the last 3 digits of the URL. We then add the id to the <code>superhero</code> dict.</p>
<p>We can get a BeautifulSoup of our page using our caching <code>get</code> function:</p>
<div class="highlight"><pre><span class="n">soup</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</pre></div>


<p>The superhero's name is the only <code>h1</code> element on the page, so we get that as follows:</p>
<p>:::python 
    superhero['name'] = soup.h1.text</p>
<p>To get the values in the Powergrid, we notice that it's actually a div with a class of tableHolder. There are a few tableHolder's on the page so we specify that we want the one contained in a div with class contentColRight. Then each row of the table is a div with class tableRow.</p>
<div class="highlight"><pre><span class="c"># Powergrid</span>
<span class="n">right_col</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;div&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;class&#39;</span><span class="p">:</span> <span class="s">&#39;contentColRight&#39;</span><span class="p">})</span>
<span class="n">table</span> <span class="o">=</span> <span class="n">right_col</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;div&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;class&#39;</span><span class="p">:</span> <span class="s">&#39;tableHolder&#39;</span><span class="p">})</span>
<span class="n">rows</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s">&#39;div&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;class&#39;</span><span class="p">:</span> <span class="s">&#39;tableRow&#39;</span><span class="p">})</span>
</pre></div>


<p>We then parse each row in the table capturing the title and the value on each row:</p>
<div class="highlight"><pre><span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;div&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;class&#39;</span><span class="p">:</span> <span class="s">&#39;tableCaptionGrid&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">text</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;div&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;class&#39;</span><span class="p">:</span> <span class="s">&#39;tableCaptionGridNr&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">text</span>
    <span class="n">superhero</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</pre></div>


<p>The last element we need for each superhero is an image. The image is contained in a div with a class of picPortrait.</p>
<div class="highlight"><pre><span class="c"># Image</span>
<span class="n">img_div</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;div&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;class&#39;</span><span class="p">:</span> <span class="s">&#39;picPortrait&#39;</span><span class="p">})</span>
<span class="n">img_src</span> <span class="o">=</span> <span class="n">img_div</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="s">&#39;src&#39;</span><span class="p">]</span>
<span class="n">img_url</span> <span class="o">=</span> <span class="n">BASE</span> <span class="o">+</span> <span class="n">img_src</span>
<span class="n">superhero</span><span class="p">[</span><span class="s">&#39;img&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">img_url</span>
</pre></div>


<p>This gives us all the data we need to build a Top Trumps card for a superhero.</p>
<p>We then run this function for every url shown in the <a href="http://www.superherodb.com/characters/">index</a></p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">get_all_data</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Scrape all superhero data. &quot;&quot;&quot;</span>

    <span class="n">start_url</span> <span class="o">=</span> <span class="s">&quot;http://www.superherodb.com/characters/&quot;</span>

    <span class="n">soup</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="n">start_url</span><span class="p">)</span>

    <span class="n">links</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s">&#39;li&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;class&#39;</span><span class="p">:</span> <span class="s">&#39;listitem&#39;</span><span class="p">})</span>

    <span class="n">superheroes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">links</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">BASE</span> <span class="o">+</span> <span class="n">link</span><span class="o">.</span><span class="n">a</span><span class="p">[</span><span class="s">&#39;href&#39;</span><span class="p">]</span>
        <span class="n">superhero</span> <span class="o">=</span> <span class="n">get_superhero_data</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">superheroes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">superhero</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">superhero</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">superheroes</span>
</pre></div>


<p>We save this data in a JSON file:</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">save_superheroes</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Scrape all superhero data and save it to a JSON file. &quot;&quot;&quot;</span>
    <span class="n">superheroes</span> <span class="o">=</span> <span class="n">get_all_data</span><span class="p">()</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;superheroes.json&#39;</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">superheroes</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>
</pre></div>


<p>Could maybe save it in a database (see Dataset).</p>
<h2>Building the game</h2>                </article>
            </aside><!-- /#featured -->
            </ol><!-- /#posts-list -->
            </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>